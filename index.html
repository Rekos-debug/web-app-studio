<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web App per Studiare</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <h1 id="welcome-message" class="hidden">Benvenuta Alessia!</h1>

        <!-- Tasto "+" con Tooltip -->
        <div id="add-button-container">
            <button id="add-button">+</button>
            <span id="tooltip" class="hidden">Aggiungi argomento</span>
        </div>

        <!-- Sezione per aggiungere e visualizzare gli argomenti -->
        <div id="add-section" class="hidden">
            <input type="text" id="new-argomento" placeholder="Inserisci un nuovo argomento (es. '122 Epatite')">
            <button id="confirm-add">Aggiungi</button>
            <ul id="argomenti-list"></ul>
        </div>

        <!-- Tasto "Sorteggia!" -->
        <button id="sorteggia-button">Sorteggia!</button>

        <!-- Risultato del sorteggio -->
        <h2 id="result" class="hidden"></h2>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

        // Configurazione Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCgER4IT8ypsTWBQAfpcOQtakrMUn4fzqo",
            authDomain: "database-argomenti-studio.firebaseapp.com",
            databaseURL: "https://database-argomenti-studio-default-rtdb.firebaseio.com",
            projectId: "database-argomenti-studio",
            storageBucket: "database-argomenti-studio.firebasestorage.app",
            messagingSenderId: "693225744695",
            appId: "1:693225744695:web:9aef511c10b20afad852b2"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Elementi della pagina
        const addButton = document.getElementById('add-button');
        const addSection = document.getElementById('add-section');
        const tooltip = document.getElementById('tooltip');
        const newArgomentoInput = document.getElementById('new-argomento');
        const confirmAddButton = document.getElementById('confirm-add');
        const argomentiList = document.getElementById('argomenti-list');
        const sorteggiaButton = document.getElementById('sorteggia-button');
        const result = document.getElementById('result');

        // Variabile per tenere traccia degli argomenti giÃ  sorteggiati
        let argomentiSorteggiati = [];

        // Mostra la scritta di benvenuto con animazione
        window.addEventListener('load', () => {
            const welcomeMessage = document.getElementById('welcome-message');
            welcomeMessage.classList.remove('hidden');
        });

        // Mostra/nasconde la sezione di aggiunta e l'elenco
        addButton.addEventListener('click', () => {
            addSection.classList.toggle('hidden');
        });

        // Mostra il tooltip quando il cursore passa sopra il tasto
        addButton.addEventListener('mouseenter', () => {
            tooltip.classList.remove('hidden');
        });

        // Nasconde il tooltip quando il cursore lascia il tasto
        addButton.addEventListener('mouseleave', () => {
            tooltip.classList.add('hidden');
        });

        // Carica argomenti dal database
        function caricaArgomenti() {
            const dbRef = ref(database);
            get(child(dbRef, "argomenti")).then((snapshot) => {
                if (snapshot.exists()) {
                    aggiornaListaArgomenti(snapshot.val());
                }
            });
        }

        // Aggiorna la lista degli argomenti
        function aggiornaListaArgomenti(argomenti) {
            argomentiList.innerHTML = '';
            argomenti.forEach((item, index) => {
                const li = document.createElement('li');
                li.textContent = item;

                // Pulsante Rimuovi
                const rimuoviButton = document.createElement('button');
                rimuoviButton.textContent = 'Rimuovi';
                rimuoviButton.onclick = () => rimuoviArgomento(index);

                li.appendChild(rimuoviButton);
                argomentiList.appendChild(li);
            });
        }

        // Aggiungi nuovo argomento
        confirmAddButton.addEventListener('click', () => {
            const nuovoArgomento = newArgomentoInput.value.trim();
            if (nuovoArgomento) {
                const dbRef = ref(database, "argomenti");
                get(dbRef).then((snapshot) => {
                    const argomenti = snapshot.exists() ? snapshot.val() : [];
                    argomenti.push(nuovoArgomento);
                    set(dbRef, argomenti).then(() => {
                        aggiornaListaArgomenti(argomenti);
                        newArgomentoInput.value = '';
                        argomentiSorteggiati = []; // Reset degli argomenti sorteggiati
                    });
                });
            }
        });

        // Rimuovi argomento
        function rimuoviArgomento(index) {
            const dbRef = ref(database, "argomenti");
            get(dbRef).then((snapshot) => {
                const argomenti = snapshot.val();
                argomenti.splice(index, 1);
                set(dbRef, argomenti).then(() => {
                    aggiornaListaArgomenti(argomenti);
                    argomentiSorteggiati = []; // Reset degli argomenti sorteggiati
                });
            });
        }

        // Sorteggia un argomento senza ripetizione fino al completamento dell'elenco
        sorteggiaButton.addEventListener('click', () => {
            const dbRef = ref(database, "argomenti");
            get(dbRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const argomenti = snapshot.val();

                    // Crea una lista di argomenti non ancora sorteggiati
                    const nonSorteggiati = argomenti.filter(arg => !argomentiSorteggiati.includes(arg));

                    if (nonSorteggiati.length === 0) {
                        // Reset se tutti gli argomenti sono stati sorteggiati
                        argomentiSorteggiati = [];
                        alert("Tutti gli argomenti sono stati sorteggiati! Ricomincio da capo.");
                        return;
                    }

                    // Sorteggia uno degli argomenti non ancora sorteggiati
                    const casuale = nonSorteggiati[Math.floor(Math.random() * nonSorteggiati.length)];
                    argomentiSorteggiati.push(casuale);

                    // Mostra il risultato
                    result.textContent = `Argomento: ${casuale}`;
                    result.classList.remove('hidden');
                } else {
                    alert("Nessun argomento disponibile!");
                }
            });
        });

        // Inizializzazione
        caricaArgomenti();
    </script>
</body>
</html>
